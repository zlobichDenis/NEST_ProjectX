generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum provider {
  GOOGLE
  YANDEX
}

enum currency {
  RUB
  USD
}

enum region_key {
  RU
}

enum product_status {
  NOT_AVAILABLE
  AVAILABLE
}

enum moderation_status {
  DECLINED
  IN_PROGRESS
  APPROVED
}

model user {
  id                    String    @id @db.Uuid
  email                 String    @unique @db.VarChar(100)
  provider              provider
  current_refresh_token String?
  created_at            DateTime  @default(now())
  updated_at            DateTime?

  seller  seller?
  profile profile?
}

model profile {
  id           String    @id @db.Uuid
  display_name String    @db.VarChar(255)
  created_at   DateTime  @default(now())
  updated_at   DateTime?

  user    user?   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id String? @unique @db.Uuid

  photo    image?  @relation(fields: [photo_id], references: [id], onDelete: Cascade)
  photo_id String? @unique @db.Uuid

  profile_address profile_address[]
}

model seller {
  id                   String    @id @db.Uuid
  display_name         String    @db.VarChar(255)
  full_name            String    @unique @db.VarChar(500)
  description          String    @db.VarChar(2000)
  contact_phone_number String    @db.VarChar(2000)
  contact_email        String    @db.VarChar(2000)
  created_at           DateTime  @default(now())
  updated_at           DateTime?

  user    user?   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id String? @unique @db.Uuid

  logo    image?  @relation(fields: [logo_id], references: [id], onDelete: Cascade)
  logo_id String? @unique @db.Uuid

  seller_address  seller_address[]
  seller_products seller_product[]
}

model seller_address {
  seller    seller @relation(fields: [seller_id], references: [id], onDelete: Cascade)
  seller_id String @db.Uuid

  address    address @relation(fields: [address_id], references: [id], onDelete: Cascade)
  address_id String  @db.Uuid

  created_at DateTime @default(now())

  @@id([seller_id, address_id])
}

model profile_address {
  profile    profile @relation(fields: [profile_id], references: [id], onDelete: Cascade)
  profile_id String  @db.Uuid

  address    address @relation(fields: [address_id], references: [id], onDelete: Cascade)
  address_id String  @db.Uuid

  created_at DateTime @default(now())

  @@id([profile_id, address_id])
}

model address {
  id           String    @unique @db.Uuid
  country      String    @db.VarChar(255)
  city         String    @db.VarChar(255)
  street       String    @db.VarChar(255)
  house_number Int
  created_at   DateTime  @default(now())
  apartment    Int?
  post_index   String?   @db.VarChar(255)
  updated_at   DateTime?

  seller_addresses seller_address[]
  profile_address  profile_address[]
}

model public_file {
  id  String @unique @db.Uuid
  key String @db.VarChar()
  url String @db.VarChar()

  created_at DateTime  @default(now())
  updated_at DateTime?

  video video?
  photo image?
}

model tag {
  id   String @id @db.Uuid
  name String @db.VarChar(255)

  created_at   DateTime      @default(now())
  product_tags product_tag[]
  updated_at   DateTime?
}

model region {
  id           String     @id @db.Uuid
  currency     currency   @unique
  key          region_key @unique
  display_name String     @db.VarChar(255)

  created_at      DateTime         @default(now())
  region_products region_product[]
}

model product {
  id                String            @id @db.Uuid
  name              String            @db.VarChar(1000)
  description       String            @db.VarChar()
  price             Float             @db.DoublePrecision
  status            product_status
  moderation_status moderation_status

  created_at DateTime  @default(now())
  updated_at DateTime?

  tags            product_tag[]
  seller_products seller_product[]
  region_products region_product[]
  product_videos  product_videos[]
  product_photos  product_photo[]
}

model product_videos {
  video    video  @relation(fields: [video_id], references: [id], onDelete: Cascade)
  video_id String @id @db.Uuid

  product    product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String  @db.Uuid

  created_at DateTime @default(now())
}

model product_photo {
  photo    image  @relation(fields: [photo_id], references: [id], onDelete: Cascade)
  photo_id String @id @db.Uuid

  product    product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String  @db.Uuid

  created_at DateTime @default(now())
}

model region_product {
  product    product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String  @db.Uuid

  region    region @relation(fields: [region_id], references: [id], onDelete: Cascade)
  region_id String @db.Uuid

  created_at DateTime @default(now())

  @@id([product_id, region_id])
}

model product_tag {
  product    product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String  @db.Uuid

  tag    tag    @relation(fields: [tag_id], references: [id], onDelete: Cascade)
  tag_id String @db.Uuid

  @@id([product_id, tag_id])
}

model seller_product {
  product    product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String  @unique @db.Uuid

  seller    seller @relation(fields: [seller_id], references: [id], onDelete: Cascade)
  seller_id String @db.Uuid

  created_at DateTime @default(now())
}

model video {
  id          String   @id @db.Uuid
  likes_count Int
  created_at  DateTime @default(now())

  file    public_file @relation(fields: [file_id], references: [id], onDelete: Cascade)
  file_id String      @unique @db.Uuid

  product_videos product_videos[]
}

model image {
  id         String   @id @db.Uuid
  created_at DateTime @default(now())

  file    public_file @relation(fields: [file_id], references: [id], onDelete: Cascade)
  file_id String      @unique @db.Uuid

  seller         seller?
  profile        profile?
  product_photos product_photo[]
}
